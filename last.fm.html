---
layout: iframe
---

<h1>Now Playing</h1>
<div>
  Loading...
</div>

<script>
 

  // Unescape HTML entities back to real HTML
  function unescapeHTML(str) {
    const div = document.createElement('div');
    div.innerHTML = str;
    return div.textContent;
  }

  async function fetchLastFM() {
    const container = document.getElementById('lastfm-info');
    if (!container) return;

    try {
      const response = await fetch('https://linuxfandudeguyapi.netlify.app/.netlify/functions/lastfm');
      if (!response.ok) throw new Error('Network response was not ok');

      const data = await response.json();

      // Build the HTML variable as ESCAPED entities
      const html = 
        '&lt;p&gt;&lt;strong&gt;Artist:&lt;/strong&gt; ' + escapeHTML(data.artist || 'N/A') + '&lt;/p&gt;' +
        '&lt;p&gt;&lt;strong&gt;Track:&lt;/strong&gt; ' + escapeHTML(data.track || 'N/A') + '&lt;/p&gt;' +
        '&lt;p&gt;&lt;strong&gt;Album:&lt;/strong&gt; ' + escapeHTML(data.album || 'N/A') + '&lt;/p&gt;';

      // Unescape just before inserting
      container.innerHTML = unescapeHTML(html);

    } catch (err) {
      container.innerHTML = unescapeHTML('&lt;p style="color:red;"&gt;Error: ' + escapeHTML(err.message) + '&lt;/p&gt;');
      console.error(err);
    }
  }

  fetchLastFM();
  setInterval(fetchLastFM, 5000);
</script>
